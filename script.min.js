var cur=[],vac=[],areas=[1,2,4,3,66,78,88,68,104,76,99,24,72,54,26,79,53,212,96,11,98,95,35,22,112,102,70,1240,90,47,77,15,71,1641,115,127,135,117,125,1002,159,160,2492],words=["Программист","Разработчик","Developer","Тимлид","Teamlead",'"Team lead"',"Тестировщик","Аналитик","Консультант",'"Project manager"','"IT Planning"','"IT Директор"','"ИТ директор"','"Директор по ИТ"','"IT Director"','"Технический директор"',"CTO",'"Chief Technical Officer"',"Engineer","Инженер","Architect","Usability",'"Директор IT департамента"','"Data mining"','"System Analyst"',"Архитектор","Programmer","Интерфейс","Инновации","Testing","QA"],minSalary=0,defaultMinSalary=100000,minFromSalary=0,defaultMinFromSalary=90000,count=0,defaultCount=50,current=0,maxHeight=221,padding=7,pageWidth=237,specializations=[],regions=[],values={specialization:"",salary:0,city:""},customLoad=false;function sortV(d,c){if(d.created_at==c.created_at){return d.area.id-c.area.id}return c.created_at-d.created_at}function sortL(d,c){if(d.value<=c.value){return -1}else{return 1}}function htmlEncode(a){return $("<div/>").text(a).html()}function validateInt(b){b=b||window.event;var a=String.fromCharCode(b.keyCode||b.which);if(!(/[0-9]/.test(a))){b.returnValue=false;if(b.preventDefault){b.preventDefault()}}}function toggleLoader(a,b){$("#page"+a+" .loader").toggle(b)}function normalizeRegions(a,c){for(var b=0;b<a.length;b++){regions.push({value:a[b].name.replace(","," /"),data:a[b].id});if(typeof a[b].areas!="undefined"&&a[b].areas.length>0){normalizeRegions(a[b].areas,false)}}if(c){regions.sort(sortL)}}function findValues(a,g){var h=g.split(/[,|;]+\s*/),f=[];for(var e=0;e<h.length;e++){var c=$.trim(h[e]).toLowerCase();var d=[];for(var b=0;b<a.length;b++){if(a[b].value.toLowerCase()==c){d=[a[b].data];break}else{if(a[b].value.toLowerCase().indexOf(c)!==-1){d.push(a[b].data)}}}f=f.concat(d)}return f.join(",")}function makeValuesTooltipe(c,a,d){var b=(c||"")+(!!a?", з/п от: "+format(a)+" руб.":"")+(d?", г. "+d:"");if(b.indexOf(", ")==0){b=b.substr(2,b.length)}$("#page0 .reset").attr("title",b)}function saveValues(b){var c=b?null:$.trim($("#tspecialization").val()),a=b?null:parseInt($.trim($("#tsalary").val())),d=b?null:$.trim($("#tcity").val());if(!!c){values.specialization=c.split(/[,|;]+\s*/);$.each(values.specialization,function(f,e){e=$.trim(e);if(e.indexOf(" ")>0){e='"'+e+'"'}values.specialization[f]=e});values.specialization=values.specialization.join(" OR ")}else{values.specialization=null}values.salary=(!isNaN(a)&&a>0)?a:null;values.city=!!d?findValues(regions,d):null;$.cookie("spec",!!values.specialization?c:null);$.cookie("specv",values.specialization);$.cookie("salary",values.salary);$.cookie("city",!!values.city?d:null);$.cookie("cityv",values.city);customLoad=!!values.specialization||!!values.salary||!!values.city;$("#page0 .reset").toggle(customLoad);$("#page0 .cust").toggle(!customLoad);makeValuesTooltipe(!!values.specialization?c:null,values.salary,!!values.city?d:null)}function loadValues(){values.specialization=$.cookie("specv");values.salary=$.cookie("salary");values.city=$.cookie("cityv");customLoad=!!values.specialization||!!values.salary||!!values.city;$("#page0 .reset").toggle(customLoad);$("#page0 .cust").toggle(!customLoad);makeValuesTooltipe(!!values.specialization?$.cookie("spec"):null,values.salary,!!values.city?$.cookie("city"):null)}function loadLists(){if(regions.length>0){return}for(var a=0;a<words.length;a++){specializations.push({value:words[a].replace(/"/ig,""),data:words[a].replace(/"/ig,"")})}specializations.sort(sortL);$("#page1 input#tspecialization").autocomplete({delimiter:/(,|;)\s*/,lookup:specializations,appendTo:"#page1 .container",containerClass:"autocomlete autospecialization",maxHeight:105,width:204,lookupFilter:function(c,b,d){return c.value.toLowerCase().indexOf(d)>=0}});$.ajax({url:"https://api.hh.ru/areas",type:"GET",dataType:"jsonp",data:{},success:function(b){normalizeRegions(b,true);if(regions.length>0){$("#page1 input#tcity").autocomplete({delimiter:/(,|;)\s*/,lookup:regions,appendTo:"#page1 .container",containerClass:"autocomlete autocity",maxHeight:105,width:204,lookupFilter:function(d,c,e){return d.value.toLowerCase().indexOf(e)==0}})}toggleLoader(1,false)},error:function(){toggleLoader(1,false)}})}function next(){var a=$("#page0 .container_vc .vc");if(a.length>1){a.stop(true,true);setTimeout(next,100);return false}if(count>0){var h=a.clone().css("top","-"+maxHeight+"px").appendTo("#page0 .container_vc"),c=h.find(".c").empty(),f="",e=maxHeight;for(var g=0;g<count;g++){var b=vac[current];var j=e-(padding*2)-$("<a "+(g!=0?'class="brd"':"")+' href="http://hh.ru/vacancy/'+b.id+'?utm_content=habr_widget&utm_medium=social&utm_campaign=habr&utm_source=habr" target="_blank">'+htmlEncode(b.name)+"<br /><span>"+b.salary+" ("+b.city+")</span></a>").appendTo(c).height();if(j<0||g==count-1){if(j<0){c.html(f);j=e}var d=c.children("a");j=parseInt(j/(d.length*2)+padding);d.each(function(i){if(i!=0){$(this).css({"margin-top":""+j+"px","padding-top":""+j+"px"})}});a.animate({top:"+="+maxHeight},700,function(){$(this).remove()});h.animate({top:"+="+maxHeight},700,function(){$("#page0 .next").show();toggleLoader(0,false)});break}if(++current>=count){current=0}f=c.html();e=j}}else{$("#page0 .vc .c").html('<p style="padding: 20px;">Подборку сделать не получится, потому что подходящие вакансии пока не опубликованы.</p>');$(".next,.cust").hide();toggleLoader(0,false)}return false}function error0(){$("#page0 .vc .c").text("Ошибка загрузки вакансий.");$(".next,.cust").hide();toggleLoader(0,false)}function format(b){b+="";var a=/(\d+)(\d{3})/;while(a.test(b)){b=b.replace(a,"$1 $2")}return b}function setPage(a){$("#page0").animate({left:((pageWidth+1)*(-a))},500);$("#page1").animate({left:((pageWidth+1)*(1-a))},500);return false}$(function(){$(".next").mousedown(function(){$(this).addClass("next_d")}).mouseup(function(){$(this).removeClass("next_d")}).click(next);$(".cust").mousedown(function(){$(this).addClass("cust_d")}).mouseup(function(){$(this).removeClass("cust_d")}).click(function(){loadLists();return setPage(1)});$(".reset").mousedown(function(){$(this).addClass("reset_d")}).mouseup(function(){$(this).removeClass("reset_d")}).click(function(){saveValues(true);loadVacancies();return setPage(0)});$(".save").mousedown(function(){$(this).addClass("save_d")}).mouseup(function(){$(this).removeClass("save_d")}).click(function(){saveValues();loadVacancies();return setPage(0)});$(".loader").css({opacity:0.6});$("input#tsalary").bind("keypress",function(b){return validateInt(b)});var a=("placeholder" in document.createElement("input"));if(!a){$("#page1 input").each(function(b){$(this).attr("placeholder","").bind("keyup keydown keypress focus blur tooltipeme",function(){var c=$(this);if(c.val()==""&&!c.hasClass("tooltiped")){c.css({"background-image":"url('img.png')"}).addClass("tooltiped")}else{if(c.val()!=""&&c.hasClass("tooltiped")){c.css({"background-image":"none"}).removeClass("tooltiped")}}}).trigger("tooltipeme")})}loadValues();$.ajax({url:"https://api.hh.ru/dictionaries",type:"GET",dataType:"jsonp",data:{},success:function(c){var b=c.currency;for(var d=0;d<b.length;d++){cur[b[d].code]=b[d].rate}loadVacancies()},error:function(){error0()}})});function loadVacancies(){$("#page0 .reset").toggle(customLoad);$("#page0 .cust").toggle(!customLoad);toggleLoader(0,true);count=defaultCount;vac=[];current=0;var a={order_by:"publication_time",period:30,page:0,per_page:count};if(!customLoad){minSalary=defaultMinSalary;minFromSalary=defaultMinFromSalary;a=$.extend(a,{search_field:"name",text:"!"+words.join(" OR !"),area:areas,specialization:1,currency:"RUR",salary:minSalary,only_with_salary:true})}else{if(!!values.city){a=$.extend(a,{area:values.city.split(",")})}if(!!values.salary){a=$.extend(a,{currency:"RUR",salary:values.salary,only_with_salary:true});minSalary=parseInt(values.salary);minFromSalary=minSalary*0.9}else{minSalary=minFromSalary=0}if(!!values.specialization){a=$.extend(a,{text:values.specialization,search_field:"name"})}}$.ajax({url:"https://api.hh.ru/vacancies",type:"GET",dataType:"jsonp",timeout:7000,data:a,traditional:true,success:function(b){if(count>b.found){count=b.found}b.items.sort(sortV);var e=null;for(var c=0;c<count;c++){var d=b.items[c];if(!d.salary){d.salary={}}if(typeof(d.salary.from)=="undefined"){d.salary.from=0}if(typeof(d.salary.to)=="undefined"){d.salary.to=0}var g=d.salary.from&&cur[d.salary.currency]?parseInt(d.salary.from/cur[d.salary.currency]):0,f=d.salary.to&&cur[d.salary.currency]?parseInt(d.salary.to/cur[d.salary.currency]):0;if(!f&&g&&g<minFromSalary){continue}if(f&&f<minSalary){continue}if(e&&d.name==e.name&&d.employer.id==e.employer.id&&d.salary.from==e.salary.from&&d.salary.to==e.salary.to){continue}vac.push({id:d.id,name:d.name,salary:!f&&!g?"":(f||!g?("До "+format(f)):("От "+format(g)))+" руб.",city:d.area.name.replace(" (",", ").replace(")","")});e=d}count=vac.length;next()},error:function(){error0()}})}jQuery.cookie=function(d,e,b){if(arguments.length>1&&(e===null||typeof e!=="object")){b=jQuery.extend({},b);if(e===null){b.expires=-1}if(typeof b.expires==="number"){var g=b.expires,c=b.expires=new Date();c.setDate(c.getDate()+g)}return(document.cookie=[encodeURIComponent(d),"=",b.raw?String(e):encodeURIComponent(String(e)),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"; path=/",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join(""))}b=e||{};var a,f=b.raw?function(h){return h}:decodeURIComponent;return(a=new RegExp("(?:^|; )"+encodeURIComponent(d)+"=([^;]*)").exec(document.cookie))?f(a[1]):null};
